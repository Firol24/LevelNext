<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Forum - Level Next</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Orbitron:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --purple: #6a0dad;
      --dark-purple: #330066;
      --yellow: #fff200;
      --neon-glow: 0 0 10px #fff200, 0 0 20px #ff0, 0 0 30px #ff0;
    }
    body {
      margin: 0;
      padding: 0;
      font-family: 'Orbitron', 'Press Start 2P', monospace;
      background-image: linear-gradient(45deg, var(--dark-purple) 0%, #000 100%);
      color: var(--yellow);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .logo {
      position: absolute; top: 20px; left: 20px;
      width: 180px; filter: drop-shadow(var(--neon-glow));
      image-rendering: pixelated; z-index: 100;
    }
    .social-sidebar {
      position: fixed; left: 10px; top: 50%;
      transform: translateY(-50%);
      display: flex; flex-direction: column; gap:15px; z-index:90;
    }
    .social-btn {
      width:50px; height:50px;
      border:3px solid var(--yellow);
      border-radius:50%;
      background:rgba(106,13,173,0.7);
      display:flex; align-items:center; justify-content:center;
      box-shadow:0 0 5px var(--yellow);
      transition: transform .3s, background .3s, box-shadow .3s;
    }
    .social-btn:hover {
      transform:scale(1.2) skewX(-10deg);
      background:var(--yellow);
      box-shadow:var(--neon-glow);
    }
    .social-btn img { width:30px; height:30px; }
    .main-content {
      display:flex; flex-direction:column; align-items:center;
      margin:100px auto 40px; text-align:center;
      max-width:600px; width:90%; padding:40px;
      background:rgba(0,0,0,0.7); border:3px solid var(--yellow);
      box-sizing:border-box;
    }
    input, textarea, button, label {
      font-family:'Press Start 2P', monospace;
      background:black; color:var(--yellow);
      border:2px solid var(--yellow);
      padding:10px; width:100%; margin:5px 0;
      box-sizing:border-box;
    }
    button {
      background:var(--yellow);
      color:var(--dark-purple);
      cursor:pointer;
      text-transform:uppercase;
    }
    button:hover { background:#ff0; }
    .thread {
      border:1px dashed var(--yellow);
      margin:20px 0; padding:10px;
      text-align:left; width:100%; box-sizing:border-box;
    }
    .thread img {
      max-width: 100%;
      margin-top: 10px;
      border: 2px solid var(--yellow);
    }
    #auth, #forum { display:none; }
  </style>
</head>
<body>
<a href="https://firol24.github.io/LevelNext">
  <img src="logo.png" alt="Level Next Logo" class="logo" />
</a>
<div class="social-sidebar">
  <a href="https://discord.gg/sHZ5k9gJ" class="social-btn" target="_blank"><img src="pngegg (1).png" alt="Discord"></a>
  <a href="https://www.twitch.tv/xfirol" class="social-btn" target="_blank"><img src="pngegg.png" alt="Twitch"></a>
  <a href="https://www.youtube.com/@tufirol9695" class="social-btn" target="_blank"><img src="icons8-youtube-48.png" alt="YouTube"></a>
  <a href="https://www.tiktok.com/@tu_firol" class="social-btn" target="_blank"><img src="icons8-tiktok-48.png" alt="TikTok"></a>
  <a href="https://www.instagram.com/_firol_" class="social-btn" target="_blank"><img src="icons8-instagram-48.png" alt="Instagram"></a>
</div>
<div id="auth" class="main-content">
  <h1>üîê Forum Level Next</h1>
  <h3>Zaloguj sie lub zarejestruj</h3>
  <input id="email-input" type="email" placeholder="Email" />
  <input id="password-input" type="password" placeholder="Haslo" />
  <button onclick="signIn()">Zaloguj</button>
  <button onclick="signUp()">Zarejestruj</button>
</div>
<div id="forum" class="main-content">
  <h1>üì° Forum</h1>
  <div id="user-info" style="margin-bottom:10px;"></div>
  <button onclick="signOut()">Wyloguj</button>
  <h3>Nowy watek</h3>
  <input id="nick-input" placeholder="Twoj nick" />
  <input id="title-input" placeholder="Tytul watku" />
  <textarea id="content-input" placeholder="Tresc watku"></textarea>
  <label>Dodaj zdjecie: <input type="file" id="image-input" accept="image/*" /></label>
  <button onclick="addThread()">Dodaj watek</button>
  <div id="threads"></div>
</div>
<script type="module">
  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'
  const supabaseUrl = 'https://xxfsvqkvoybdyanmqnpg.supabase.co'
  const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh4ZnN2cWt2b3liZHlhbm1xbnBnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM5MDg5NjAsImV4cCI6MjA2OTQ4NDk2MH0.1vzkild4JfMdvViTTJ3IggU6YwclZYbCcmuZ28JtF88'
  const supabase = createClient(supabaseUrl, supabaseKey)
  const adminEmail = 'filipiakr245@gmail.com'
  let currentUser = null

  supabase.auth.onAuthStateChange((_, session) => {
    if (session?.user) {
      currentUser = session.user
      showForum()
    } else {
      currentUser = null
      showAuth()
    }
  })

  ;(async()=>{
    const { data:{ session } } = await supabase.auth.getSession()
    if (session?.user) {
      currentUser = session.user
      showForum()
    } else {
      showAuth()
    }
  })()

  function showAuth(){
    document.getElementById('auth').style.display = 'flex'
    document.getElementById('forum').style.display = 'none'
  }

  function showForum(){
    document.getElementById('auth').style.display = 'none'
    document.getElementById('forum').style.display = 'flex'
    document.getElementById('user-info').textContent = `Witaj, ${currentUser.email}`
    fetchThreads()
  }

  window.signUp = async ()=>{
    const email = document.getElementById('email-input').value
    const pass  = document.getElementById('password-input').value
    const { error } = await supabase.auth.signUp({ email, password: pass })
    if (error) alert('Blad rejestracji: '+error.message)
    else alert('Sprawdz email i potwierdz konto!')
  }

  window.signIn = async ()=>{
    const email = document.getElementById('email-input').value
    const pass  = document.getElementById('password-input').value
    const { error } = await supabase.auth.signInWithPassword({ email, password: pass })
    if (error) alert('Blad logowania: '+error.message)
  }

  window.signOut = async ()=>{ await supabase.auth.signOut() }

  window.fetchThreads = async ()=>{
    const { data, error } = await supabase
      .from('threads')
      .select('id,nick,title,content,created_at,image_url,user_id')
      .order('created_at',{ascending:false})
    if (error) {
      console.error('B≈ÇƒÖd fetch:',error)
      return
    }
    const container = document.getElementById('threads')
    container.innerHTML = ''
    data.forEach(t=>{
      const dateStr = new Date(t.created_at).toLocaleString('pl-PL',{hour12:false})
      const div = document.createElement('div')
      div.className = 'thread'
      div.innerHTML = `
        <h3>${t.title}</h3>
        <p><b>${t.nick}</b>: ${t.content}</p>
        ${t.image_url ? `<img src="${t.image_url}" alt="zalaczone zdjecie">` : ''}
        <p style="font-size:0.8em;"><i>${t.nick}</i> ‚Ä¢ ${dateStr}</p>
        <div class="thread-actions">
          ${(t.user_id===currentUser.id||currentUser.email===adminEmail)
            ? `<button onclick="deleteThread(${t.id})">Usun</button>` : ''}
        </div>
      `
      container.appendChild(div)
    })
  }

  window.addThread = async ()=>{
    if(!currentUser) return alert('Musisz byc zalogowany!')
    const nick = document.getElementById('nick-input').value.trim()
    const title = document.getElementById('title-input').value.trim()
    const content = document.getElementById('content-input').value.trim()
    const file = document.getElementById('image-input').files[0]
    if(!nick||!title||!content) return alert('Uzupelnij nick, tytul i tresc!')

    let imageUrl = null
    if (file) {
      const fileName = `${Date.now()}_${file.name}`
      const { data, error:uploadError } = await supabase.storage
        .from('forum-uploads')
        .upload(fileName, file)
      if (uploadError) {
        alert('Blad uploadu: '+uploadError.message)
        return
      }
      const { data: publicUrl } = supabase.storage
        .from('forum-uploads')
        .getPublicUrl(fileName)
      imageUrl = publicUrl.publicUrl
    }

    const { error } = await supabase
      .from('threads')
      .insert([{ nick, title, content, user_id: currentUser.id, image_url: imageUrl }])
    if (error) alert('Blad przy dodawaniu: '+error.message)
    else {
      document.getElementById('nick-input').value = ''
      document.getElementById('title-input').value = ''
      document.getElementById('content-input').value = ''
      document.getElementById('image-input').value = ''
      fetchThreads()
    }
  }

  window.deleteThread = async id=>{
    if(!confirm('Na pewno usunac?')) return
    const { error } = await supabase.from('threads').delete().eq('id',id)
    if(error) alert('Blad usuwania:'+error.message)
    else fetchThreads()
  }
</script>
</body>
</html>
