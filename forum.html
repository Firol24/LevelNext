<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Forum - Level Next</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Orbitron:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --purple: #6a0dad;
      --dark-purple: #330066;
      --yellow: #fff200;
      --neon-glow: 0 0 10px #fff200, 0 0 20px #ff0, 0 0 30px #ff0;
    }
    body {
      margin: 0;
      padding: 0;
      background: #000;
      background-image: linear-gradient(45deg, var(--dark-purple) 0%, #000 100%);
      color: var(--yellow);
      font-family: 'Orbitron','Press Start 2P',monospace;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .logo {
      position: absolute; top: 20px; left: 20px;
      width: 180px; filter: drop-shadow(var(--neon-glow));
      image-rendering: pixelated; z-index: 100;
    }
    .social-sidebar {
      position: fixed; left: 10px; top: 50%;
      transform: translateY(-50%);
      display: flex; flex-direction: column; gap:15px; z-index:90;
    }
    .social-btn {
      width:50px; height:50px;
      border:3px solid var(--yellow);
      border-radius:50%;
      background:rgba(106,13,173,0.7);
      display:flex; align-items:center; justify-content:center;
      box-shadow:0 0 5px var(--yellow);
      transition: transform .3s, background .3s, box-shadow .3s;
    }
    .social-btn:hover {
      transform:scale(1.2) skewX(-10deg);
      background:var(--yellow);
      box-shadow:var(--neon-glow);
    }
    .social-btn img { width:30px; height:30px; }
    .main-content {
      display:flex; flex-direction:column; align-items:center;
      margin:100px auto 40px; text-align:center;
      max-width:600px; width:90%; padding:40px;
      background:rgba(0,0,0,0.7); border:3px solid var(--yellow);
      box-sizing:border-box;
    }
    h1 { font-size:1.8em; margin-bottom:20px; }
    input, textarea, button {
      font-family:'Press Start 2P',monospace;
      background:black; color:var(--yellow);
      border:2px solid var(--yellow);
      padding:10px; width:100%; margin:5px 0;
      box-sizing:border-box;
    }
    button {
      background:var(--yellow);
      color:var(--dark-purple);
      cursor:pointer;
      text-transform:uppercase;
    }
    button:hover { background:#ff0; }
    .thread {
      border:1px dashed var(--yellow);
      margin:20px 0; padding:10px;
      text-align:left; width:100%; box-sizing:border-box;
    }
    .thread h3 { margin:0 0 10px; }
    .thread p { margin:0 0 10px; }
    .thread-actions {
      display:flex; justify-content:flex-end; gap:10px;
    }
    #auth, #forum { display:none; }
  </style>
</head>
<body>

  <img src="logo.png" alt="Level Next Logo" class="logo" />

  <div class="social-sidebar">
    <!-- social buttons... -->
  </div>

  <!-- formularz logowania/rejestracji -->
  <div id="auth" class="main-content">
    <!-- auth form... -->
  </div>

  <!-- wÅ‚aÅ›ciwe forum -->
  <div id="forum" class="main-content">
    <h1>ðŸ“¡ Forum</h1>
    <div id="user-info" style="margin-bottom:10px;"></div>
    <button onclick="signOut()">Wyloguj</button>

    <h3>Nowy watek</h3>
    <input id="nick-input"    placeholder="Twoj nick" />
    <input id="title-input"   placeholder="Tytul watku"/>
    <textarea id="content-input" placeholder="Tresc watku"></textarea>
    <button onclick="addThread()">Dodaj watek</button>

    <div id="threads"></div>
  </div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'
    const supabaseUrl = 'https://xxfsvqkvoybdyanmqnpg.supabase.co'
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5...TwYwclZYbCcmuZ28JtF88'
    const supabase    = createClient(supabaseUrl, supabaseKey)
    const adminEmail  = 'filipiakr245@gmail.com'
    let currentUser = null

    supabase.auth.onAuthStateChange((_, session) => {
      if (session?.user) { currentUser = session.user; showForum() }
      else               { currentUser = null;       showAuth()  }
    })

    ;(async()=>{
      const { data:{ session } } = await supabase.auth.getSession()
      if (session?.user) { currentUser = session.user; showForum() }
      else               { showAuth() }
    })()

    function showAuth(){
      document.getElementById('auth').style.display  = 'flex'
      document.getElementById('forum').style.display = 'none'
    }
    function showForum(){
      document.getElementById('auth').style.display  = 'none'
      document.getElementById('forum').style.display = 'flex'
      document.getElementById('user-info').textContent = `Witaj, ${currentUser.email}`
      fetchThreads()
    }

    window.signUp = async ()=>{
      /* signUp logic */
    }
    window.signIn = async ()=>{
      /* signIn logic */
    }
    window.signOut = async ()=>{ await supabase.auth.signOut() }

    window.fetchThreads = async ()=>{
      const { data, error } = await supabase
        .from('threads')
        .select('id,nick,title,content,created_at')
        .order('created_at',{ascending:false})
      if (error) {
        console.error('BÅ‚Ä…d fetch:',error)
        return
      }
      const c = document.getElementById('threads')
      c.innerHTML=''
      data.forEach(t=>{
        const dateStr = new Date(t.created_at)
          .toLocaleString('pl-PL',{hour12:false})
        const div=document.createElement('div')
        div.className='thread'
        div.innerHTML=`
          <h3>${t.title}</h3>
          <p><b>${t.nick}</b>: ${t.content}</p>
          <p style="font-size:0.8em;">
            <i>${t.nick}</i> â€¢ ${dateStr}
          </p>
          <div class="thread-actions">
            ${ (t.user_id===currentUser.id||currentUser.email===adminEmail)
                ? `<button onclick="deleteThread(${t.id})">Usun</button>` : ''}
            ${ t.user_id===currentUser.id
                ? `<button onclick="editThread(${t.id})">Edytuj</button>` : ''}
          </div>
        `
        c.appendChild(div)
      })
    }

    window.addThread = async ()=>{
      /* addThread logic */
    }
    window.deleteThread = async id=>{
      /* deleteThread logic */
    }
    window.editThread = async id=>{
      /* editThread logic */
    }
  </script>
</body>
</html>
